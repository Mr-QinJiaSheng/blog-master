var dwqr_cnf={};!function(){for(var e=dwqr_opt.split("|"),t=["ver","dir","uid","api","pid"],o=0;o<t.length;o++)dwqr_cnf[t[o]]=e[o]}(),jQuery(document).ready(function(c){var e=function(e){var i,t=e||c(".wb-btn-like"),o=dwqr_cnf.uid||0,a=o?"WB_LOCAL_DATA_"+o:"WB_LOCAL_DATA_VISITOR",r=localStorage.getItem(a)?JSON.parse(localStorage.getItem(a)):{};r.post_liked_items||(r.post_liked_items=[]),i=r.post_liked_items,0<t.length&&t.each(function(){var e=c(this),t=dwqr_cnf.pid,o=e.data("count");t&&-1<i.indexOf(t)&&(e.addClass("active"),e.find(".like-count").eq(0).html("已赞("+o+")"))}),t.on("click",function(){var o=c(this),n=dwqr_cnf.pid,e=decodeURIComponent(dwqr_cnf.api);o.hasClass("active")||c.post(e,{action:"dwqr_ajax",do:"like",post_id:n},function(e){if(e){var t=1<e?999<e?"已赞("+parseInt(e/1e3)+"k+)":"已赞("+e+")":"已赞";o.find(".like-count").eq(0).html(t),o.addClass("active"),i.indexOf(n)<0&&i.push(n),localStorage.setItem(a,JSON.stringify(r))}})})},o={bySocial:function(e){c(".j-dwqr-social-btn").on("click",function(){wbui.open({title:"分享到...",content:wb_dwqr_share_html,className:"wbui-dwqr-share",success:function(){c(".wb-share-list .share-logo").on("click",function(){var e=c(this).attr("data-cmd"),t=encodeURI(document.title),o=c('meta[name="description"]').attr("content"),n=c(".wb-share-list").attr("data-cover"),i=encodeURI(window.location.href);switch(n=n?encodeURI(n):"",e){case"weibo":window.open("https://service.weibo.com/share/share.php?url="+i+"&title="+t+"&pic="+n+"&searchPic=true","_blank");break;case"qzone":window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i+"&title="+t+"&summary="+o+"&pics="+n,"_blank");break;case"qq":window.open("http://connect.qq.com/widget/shareqq/index.html?url="+i+"&title="+t+"&summary="+o+"&pics="+n,"_blank");break;case"weixin":wbui.open({title:"扫码打开",content:'<div class="qrbox" id="J_shareQrBox"></div> <p>用手机扫码即可打开该页。</p>',className:"wbui-qrbox",success:function(){new QRCode("J_shareQrBox",{text:i,width:200,height:200,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H})}})}})}})})},poster:function(){c(document).on("click",".wb-share-poster",function(){c(this).data("id");wbui.open({type:"wbui-share-poster",content:'<div class="mobile-share-wrap"><div class="loading">分享图片生成中...</div><div id="J_shareQRCode" style="display: none;"></div></div><div class="poster-share-tips">请长按图片，将内容推荐给好友</div>',success:function(){var e=encodeURI(window.location.href);new QRCode("J_shareQRCode",{text:e,width:200,height:200,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H});c.ajax({url:decodeURIComponent(dwqr_cnf.api),data:{id:dwqr_cnf.pid,action:"dwqr_ajax",do:"wb_share_poster"},method:"POST",dataType:"json",timeout:1e4,success:function(e){e.callback=function(e){c(".mobile-share-wrap").html('<img src="'+e+'">')};var t=c("#J_shareQRCode img");e.qrcode=t.attr("src"),c("#J_shareQRCode").remove(),e.head&&e.logo&&e.qrcode?o.canvas(e):wbui.alert("生成分享图片失败",function(){wbui.closeAll()})},error:function(){wbui.alert("获取分享图片失败",function(){wbui.closeAll()})}})}})})},canvas:function(f){var g=document.createElement("canvas"),m=g.getContext("2d"),p=640;g.width=p,g.height=1e4;var v=0;m.fillStyle="#fff",m.fillRect(0,0,g.width,g.height);var b=new Image;function _(e,t,o,n,i){for(var a=0,r=0,c=0;c<e.length;c++)560<(a+=i.measureText(e[c]).width)&&(i.fillText(e.substring(r,c),t,o),o+=n,a=0,r=c),c==e.length-1&&(i.fillText(e.substring(r,c+1),t,o),o+=n);return o}b.crossOrigin="anonymous",f.head.match(/^\/\//)&&(f.head=window.location.protocol+f.head),b.src=f.head,b.onerror=function(e){wbui.alert("生成分享图片失败",function(){wbui.closeAll()})},b.onload=function(){var e=parseInt(2*p/3),t=parseInt(2*b.width/3),o=0,n=b.width,i=b.height,a=p,r=e,c=0,s=0;b.height===b.width?(c=parseInt((p-e)/2)+20,r=a=e-40,s=40):b.height>t?i=t:b.height<t&&(n=parseInt(3*i/2),o=parseInt((b.width-n)/2)),v+=e,m.drawImage(this,o,0,n,i,c,s,a,r);var l=new Date(1e3*f.timestamp),d=l.getDate(),h=l.getFullYear(),w=l.getMonth()+1;d=d<10?"0"+d:""+d,w=h+"/"+(w=w<10?"0"+w:""+w);m.stroke(),m.fillStyle="#000",m.textAlign="center",m.font="600 36px serif",v+=80,v=_(jQuery("<div>").html(f.title).text(),320,v,50,m),m.textAlign="left",m.fillStyle="#333",m.font="300 26px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Ubuntu,Helvetica Neue,Helvetica,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Source Han Sans CN,sans-serif",v+=30,v=_(jQuery("<div>").html(f.excerpt).text(),30,v,42,m),v+=100,m.lineWidth=1,m.beginPath(),m.setLineDash([7,7]),m.strokeStyle="#ccc",m.moveTo(0,v),m.lineTo(p,v),m.stroke();var u=new Image;u.crossOrigin="anonymous",f.logo.match(/^\/\//)&&(f.logo=window.location.protocol+f.logo),u.src=f.logo,u.onerror=function(e){wbui.alert("生成分享图片失败",function(){wbui.closeAll()})},u.onload=function(){v+=40;var n=400/u.width*u.height;n=100<n?100:n;var e=u.width/(u.height/n);n=(e=400<e?400:e)/u.width*u.height,m.drawImage(this,0,0,u.width,u.height,30,v+(100-n)/2,e,n);var i=new Image;i.src=f.qrcode,i.onerror=function(e){wbui.alert("生成分享图片失败",function(){wbui.closeAll()})},i.onload=function(){m.drawImage(this,0,0,i.width,i.height,510,v,100,100/i.width*i.height);var e=100/i.width*i.height;v+=n<e?e:n,v+=40;var t=m.getImageData(0,0,p,v);g.height=v,m.putImageData(t,0,0);var o=g.toDataURL("image/jpeg",1);f.callback(o)}}}}};c(".wb-btn-like").length&&e(),c(".j-dwqr-social-btn").length&&o.bySocial(),c(".wb-share-poster").length&&o.poster(),c(".j-dwqr-donate-btn").length&&c(".j-dwqr-donate-btn").on("click",function(){wbui.open({content:wb_dwqr_donate_html,className:"wbui-dwqr-donate",success:function(){var e=c(".wbui-dwqr-donate"),t=e.find(".tab-nav-item"),o=e.find(".tab-cont"),n="current",i=0;t.on("click",function(){i=c(this).index(),t.removeClass(n).eq(i).addClass(n),o.removeClass(n).eq(i).addClass(n)})}})})}),function(e,t){"use strict";var o=decodeURIComponent(dwqr_cnf.dir)+"/assets/wb_svg.html",n=dwqr_cnf.ver,i="WBP_DWQR_SVG_VER",a="WBP_DWQR_SVG_DATA";if(!t.createElementNS||!t.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)return;function r(){t.body.insertAdjacentHTML("afterbegin",l)}function c(){t.body?r():t.addEventListener("DOMContentLoaded",r)}var s,l,d="localStorage"in e&&null!==e.localStorage;if(d&&localStorage.getItem(i)===n&&(l=localStorage.getItem(a)))return c();try{(s=new XMLHttpRequest).open("GET",o,!0),s.onload=function(){200<=s.status&&s.status<400&&(l=s.responseText,c(),d&&(localStorage.setItem(a,l),localStorage.setItem(i,n)))},s.send()}catch(e){}}(window,document)